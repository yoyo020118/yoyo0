<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>YOYO V24 - ULTRA EDITION</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* --- Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ --- */
        :root { 
            --bg: #1e272e; 
            --primary: #00d2d3; 
            --sec: #54a0ff; 
            --card: #2f3640; 
            --txt: #fff; 
            --gold: #f1c40f; 
            --danger: #ff4757;
        }
        body { font-family: 'Tajawal', sans-serif; background: var(--bg); color: var(--txt); margin:0; padding-bottom:80px; overflow-x:hidden; user-select:none; transition: background 0.5s; }
        button { font-family: 'Tajawal', sans-serif; cursor:pointer; transition:0.2s; } button:active{transform:scale(0.95);}
        input { font-family: 'Tajawal', sans-serif; }

        /* Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
        #loading-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 99999; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: opacity 0.5s; }
        .loader { border: 5px solid #333; border-top: 5px solid var(--primary); border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Toast Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© (Ø¬Ø¯ÙŠØ¯) */
        #toast-container { position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%); z-index: 10000; display: flex; flex-direction: column; gap: 10px; pointer-events: none; }
        .toast { background: rgba(0,0,0,0.9); color: white; padding: 12px 25px; border-radius: 50px; font-size: 14px; animation: slideUp 0.3s ease; display: flex; align-items: center; gap: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.5); border: 1px solid #444; min-width: 200px; justify-content: center; pointer-events: auto; }
        .toast.success { border-color: #2ecc71; color: #2ecc71; }
        .toast.error { border-color: #e74c3c; color: #e74c3c; }
        .toast.info { border-color: var(--primary); color: var(--primary); }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ø¹Ø§Ø¬Ù„Ø© */
        #breaking-news-bar { background: red; color: white; padding: 5px; font-size: 14px; white-space: nowrap; overflow: hidden; display: none; }
        #breaking-text { display: inline-block; animation: scrollLeft 15s linear infinite; }
        @keyframes scrollLeft { from { transform: translateX(100%); } to { transform: translateX(-100%); } }

        .header { background:rgba(0,0,0,0.95); padding:10px 15px; display:flex; justify-content:space-between; align-items:center; border-bottom:3px solid var(--primary); position:sticky; top:0; z-index:100; transition: border-color 0.5s; }
        .user-badge { background:#333; padding:5px 15px; border-radius:20px; border:1px solid var(--primary); font-size:12px; display:flex; gap:10px; align-items:center; }
        .user-avatar-small { width:30px; height:30px; border-radius:50%; background:#555; object-fit: cover; border:1px solid white; }

        /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© */
        .sidebar { position:fixed; top:0; right:-280px; width:280px; height:100%; background:var(--card); z-index:200; transition:0.4s; padding-top:60px; box-shadow:-5px 0 20px #000; display:flex; flex-direction:column; overflow-y:auto; }
        .sidebar.active { right:0; }
        .nav-btn { background:none; border:none; color:white; padding:15px; text-align:right; border-bottom:1px solid #444; font-size:18px; width:100%; position:relative; }
        .notif-dot { width:10px; height:10px; background:red; border-radius:50%; position:absolute; top:15px; left:15px; display:none; box-shadow:0 0 5px red; }

        /* Ø§Ù„ØµÙØ­Ø§Øª */
        .page { display:none; padding:20px; max-width:800px; margin:0 auto; animation:fadeIn 0.5s; }
        .page.active { display:block; }
        @keyframes fadeIn { from{opacity:0;transform:translateY(10px)} to{opacity:1;transform:translateY(0)} }

        /* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
        .profile-card { background: linear-gradient(135deg, var(--card), #000); border: 2px solid var(--primary); border-radius: 15px; padding: 20px; margin: 20px auto; max-width: 350px; text-align: center; box-shadow: 0 0 20px rgba(0,0,0, 0.5); transition: border-color 0.5s; position:relative; overflow:hidden; }
        .copy-btn { background: var(--primary); color: black; border: none; padding: 2px 8px; border-radius: 4px; font-size: 12px; margin-right: 5px; }

        /* Ø´Ø±ÙŠØ· XP (Ø¬Ø¯ÙŠØ¯) */
        .xp-container { width: 100%; height: 5px; background: #333; margin-top: 5px; border-radius: 5px; overflow: hidden; }
        .xp-bar { height: 100%; background: linear-gradient(90deg, #00b894, #55efc4); width: 0%; transition: width 0.5s; }
        .bio-text { color: #aaa; font-size: 12px; font-style: italic; margin-top: 5px; }

        /* Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ */
        .game-card { background:linear-gradient(145deg, #1e272e, #111); padding:20px; border-radius:15px; border:1px solid #333; transition:0.3s; overflow:hidden; text-align:center; margin-bottom:15px; }
        .btn-main { width:100%; background:var(--primary); color:black; border:none; padding:10px; margin-top:10px; border-radius:5px; font-weight:bold; font-size:16px; box-shadow: 0 4px 0 rgba(0,0,0,0.5); transition: background 0.5s; }
        .btn-main:active { transform: translateY(4px); box-shadow: none; }
        
        /* Ø§Ù„Ø´Ø§Øª */
        .chat-container { display:flex; flex-direction:column; gap:10px; padding:10px; height:350px; overflow-y:auto; background:#151520; border-radius:10px; border:1px solid #333; }
        .msg-bubble { max-width: 75%; padding: 10px 15px; border-radius: 15px; font-size: 14px; position: relative; word-wrap: break-word; line-height: 1.4; animation: popIn 0.3s ease; }
        .msg-user { background: linear-gradient(135deg, var(--sec), var(--primary)); color: white; align-self: flex-start; margin-right: auto; margin-left: 0; border-bottom-right-radius: 2px; }
        .msg-admin { background: #333; color: #ddd; align-self: flex-end; margin-left: auto; margin-right: 0; border-bottom-left-radius: 2px; border: 1px solid #555; }
        .chat-mine { background:var(--sec); align-self:flex-end; border-bottom-left-radius:0; margin-left:auto; }
        .chat-other { background:#444; align-self:flex-start; border-bottom-right-radius:0; margin-right:auto; }

        /* Ø´Ø§Ø±Ø§Øª VIP Ùˆ Admin ÙˆØ§Ù„ÙƒÙ„Ø§Ù†Ø§Øª */
        .vip-badge { background: linear-gradient(45deg, #f1c40f, #e67e22); color: black; padding: 2px 8px; border-radius: 8px; font-weight: bold; font-size: 10px; margin-left: 5px; box-shadow: 0 0 8px #f1c40f; border: 1px solid white; display: inline-block; }
        .admin-badge { background: red; color: white; padding: 2px 8px; border-radius: 8px; font-weight: bold; font-size: 10px; margin-left: 5px; box-shadow: 0 0 8px red; border: 1px solid white; display: inline-block; }
        .clan-badge { background: #8e44ad; color: white; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-family: monospace; border: 1px solid #9b59b6; margin-left:5px; }

        /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ */
        .name-gold { color: #ffd700 !important; text-shadow: 0 0 5px #b8860b; font-weight: bold; }
        .name-red { color: #ff4757 !important; text-shadow: 0 0 5px #c0392b; font-weight: bold; }
        .name-blue { color: #00d2d3 !important; text-shadow: 0 0 5px #009797; font-weight: bold; }

        /* Ø§Ù„Ø£ÙØ§ØªØ§Ø± */
        .avatar-grid { display:grid; grid-template-columns: repeat(4, 1fr); gap:10px; margin:15px 0; }
        .avatar-option { width:50px; height:50px; border-radius:50%; border:2px solid transparent; cursor:pointer; }
        .leader-item { background:#222; padding:10px; margin-bottom:5px; border-radius:5px; display:flex; justify-content:space-between; align-items:center; }
        .rank-badge { width:25px; height:25px; border-radius:50%; background:var(--gold); color:black; display:flex; align-items:center; justify-content:center; font-weight:bold; }

        /* Ù„Ø¹Ø¨Ø© BATTLE ARENA */
        #game-wrapper { position: relative; width: 100%; max-width: 600px; margin: 0 auto; height: 350px; overflow: hidden; border: 4px solid #555; border-radius: 10px; background: #2d3436; box-shadow: 0 0 20px #000; background-image: linear-gradient(#333 1px, transparent 1px), linear-gradient(90deg, #333 1px, transparent 1px); background-size: 40px 40px; }
        #soccer-canvas { display: block; width: 100%; height: 100%; }
        .score-board { position: absolute; top: 5px; left: 0; width: 100%; display: flex; justify-content: center; gap: 20px; z-index: 10; }
        .player-stat { background: rgba(0,0,0,0.6); padding: 5px 10px; border-radius: 5px; color: white; border: 1px solid #555; display:flex; align-items:center; gap:5px; }
        .hp-bar-mini { width: 50px; height: 5px; background: red; margin-top: 3px; }
        .hp-val { width: 100%; height: 100%; background: #0f0; transition: width 0.1s; }
        
        /* Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø­Ø³Ù†Ø© (Joystick) */
        .touch-controls { position: absolute; bottom: 10px; left: 0; width: 100%; height: 120px; pointer-events: none; display: flex; justify-content: space-between; padding: 0 20px; box-sizing: border-box; }
        .joystick-area { pointer-events: auto; width: 120px; height: 120px; background: rgba(255,255,255,0.05); border-radius: 50%; border: 2px solid rgba(255,255,255,0.1); position: relative; display: flex; justify-content: center; align-items: center; }
        .joystick-knob { width: 50px; height: 50px; background: rgba(255,255,255,0.2); border-radius: 50%; position: absolute; box-shadow: 0 0 10px rgba(0,0,0,0.5); }
        .action-btn { pointer-events: auto; display: flex; align-items: center; }
        .btn-fire { width: 70px; height: 70px; border-radius: 50%; background: rgba(231, 76, 60, 0.4); border: 2px solid #e74c3c; font-size: 30px; display:flex; justify-content:center; align-items:center; color:white; transition:0.1s; }
        .btn-fire:active { background: #e74c3c; transform: scale(0.9); }
        
        .room-box { background: #222; padding: 20px; border-radius: 10px; text-align: center; border: 1px solid var(--primary); }

        /* Ø§Ù„Ù†ÙˆØ§ÙØ° */
        .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95); z-index:300; justify-content:center; align-items:center; }
        .modal-box { background:var(--card); width:90%; max-width:600px; padding:20px; border-radius:15px; border:1px solid var(--sec); text-align:center; max-height:90vh; overflow-y:auto; position: relative; }
        .float-btn { position:fixed; bottom:20px; right:20px; background:linear-gradient(45deg, #ff9f43, #ee5253); color:white; border:none; padding:12px 25px; border-radius:50px; font-weight:bold; box-shadow:0 5px 15px #000; z-index:150; }
        
        /* --------------------------------- */
        /* --- Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù† (ULTIMATE) --- */
        /* --------------------------------- */
        .admin-trigger-btn { position:fixed; bottom:10px; left:10px; width:40px; height:40px; opacity:0.1; background:red; z-index:200; border:none; border-radius:50%; }
        .adm-header { display:flex; gap:10px; padding-bottom:15px; border-bottom:2px solid var(--gold); margin-bottom:15px; overflow-x:auto; }
        .adm-nav-btn { background:transparent; border:1px solid #444; color:#aaa; padding:8px 15px; border-radius:20px; white-space:nowrap; position:relative; }
        .adm-nav-btn.active { background:var(--gold); color:black; border-color:var(--gold); font-weight:bold; }
        .adm-section { display:none; animation:fadeIn 0.3s; height: 100%; }
        .adm-section.active { display:block; }
        .online-list-container { max-height:300px; overflow-y:auto; background:#151515; border-radius:10px; }
        .online-user-row { display:flex; align-items:center; justify-content:space-between; padding:12px; border-bottom:1px solid #333; transition:0.2s; }
        .online-user-row:hover { background:#252525; }
        .online-status { width:8px; height:8px; background:#0f0; border-radius:50%; display:inline-block; margin-left:5px; }

        /* Ø²Ø± Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… */
        .btn-ctrl-user { background: var(--primary); color: black; border: none; padding: 5px 10px; border-radius: 5px; font-size: 12px; font-weight: bold; margin-right: 5px; }

        .support-layout { display:flex; height:100%; gap:10px; }
        .support-list { width:35%; border-left:1px solid #333; overflow-y:auto; background:#111; border-radius:5px; height: 400px; }
        .support-chat-view { width:65%; display:flex; flex-direction:column; background:#111; border-radius:5px; padding:5px; height: 400px; }
        .chat-list-item { padding:15px; border-bottom:1px solid #333; cursor:pointer; position:relative; transition:0.2s; text-align:right; }
        .chat-list-item.active { background:#333; border-right:3px solid var(--primary); }
        .unread-badge { width:10px; height:10px; background:red; border-radius:50%; position:absolute; top:15px; left:10px; box-shadow: 0 0 5px red; display:none; }
        .global-badge { position:absolute; top:-5px; left:-5px; background:red; color:white; font-size:10px; padding:2px 5px; border-radius:50%; display:none; }

        .settings-grid { display:grid; grid-template-columns: 1fr 1fr; gap:15px; text-align:right; }
        .setting-card { background:#1a1a1a; padding:15px; border-radius:10px; border:1px solid #333; }
        .setting-label { display:block; margin-bottom:5px; color:#ccc; }
        .custom-input { width:100%; padding:10px; background:#333; border:1px solid #555; color:white; border-radius:5px; margin-bottom:10px; text-align:center; }
        .save-btn { grid-column:span 2; background:var(--primary); color:black; font-weight:bold; padding:15px; margin-top:10px; border-radius:10px; }
        
        .adm-table { width:100%; border-collapse:collapse; color:#ccc; font-size:12px; }
        .adm-table th, .adm-table td { border:1px solid #333; padding:8px; text-align:center; }
        .adm-table th { background:#222; color:var(--primary); }

        /* Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ù…ØªØµÙ„ÙŠÙ† Ø§Ù„Ù…Ø­Ø³Ù†Ø© */
        #user-control-browser { 
            display:none; 
            position:fixed; 
            top:50%; left:50%; 
            transform:translate(-50%, -50%); 
            width:90%; max-width:400px; 
            background:#2c3e50; 
            border:2px solid var(--gold); 
            border-radius:15px; 
            padding:20px; 
            z-index:99999; 
            box-shadow:0 0 50px rgba(0,0,0,0.8);
            flex-direction: column;
        }

        .ctrl-panel-header { display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #333; padding-bottom:10px; margin-bottom:10px; }
        .action-grid { display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:15px; }
        .act-btn { padding:10px; border:none; border-radius:5px; font-weight:bold; color:white; cursor:pointer; transition:0.2s; }
        .act-btn:active { transform:scale(0.95); }
        .act-add { background: #2ecc71; }
        .act-sub { background: #e67e22; }
        .act-ban { background: #c0392b; }
        .act-mute { background: #7f8c8d; }
        .act-freeze { background: #3498db; }

        /* Ø³ØªØ§ÙŠÙ„ Ø²Ø± Ø­Ø°Ù Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙÙŠ Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© */
        .monitor-msg-row { display:flex; justify-content:space-between; align-items:center; padding:5px; background:#222; margin-bottom:5px; border-radius:5px; border-right:3px solid #555; }
        .monitor-actions { display:flex; gap:5px; }
        .btn-del-msg { background:red; color:white; border:none; border-radius:3px; padding:2px 5px; cursor:pointer; }
        .btn-ban-user { background:black; color:red; border:1px solid red; border-radius:3px; padding:2px 5px; cursor:pointer; }

        #global-alert-modal { z-index: 500; }
        .alert-box { background: linear-gradient(135deg, #000, #333); border: 2px solid red; padding: 30px; text-align: center; border-radius: 20px; box-shadow: 0 0 50px red; animation: popIn 0.5s; }
        @keyframes popIn { from{transform:scale(0)} to{transform:scale(1)} }

    </style>
</head>
<body class="ar">

    <!-- Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© -->
    <div id="toast-container"></div>

    <!-- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
    <div id="loading-screen">
        <div class="loader"></div>
        <h3 style="color:var(--primary); margin-top:20px;">Ø¬Ø§Ø±Ù Ø§Ù„Ø§ØªØµØ§Ù„...</h3>
    </div>
    
    <!-- Ø£ØµÙˆØ§Øª -->
    <audio id="snd-click" src="https://assets.mixkit.co/sfx/preview/mixkit-modern-technology-select-3124.mp3"></audio>
    <audio id="snd-shot" src="https://assets.mixkit.co/sfx/preview/mixkit-laser-gun-shot-3110.mp3"></audio>
    <audio id="snd-hit" src="https://assets.mixkit.co/sfx/preview/mixkit-small-hit-in-a-game-2072.mp3"></audio>
    <audio id="snd-win" src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3"></audio>
    <audio id="snd-notif" src="https://assets.mixkit.co/sfx/preview/mixkit-software-interface-start-2574.mp3"></audio>

    <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø­Ø¸Ø± Ø§Ù„ÙƒØ§Ù…Ù„ -->
    <div id="banned-screen" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:black; z-index:9999; flex-direction:column; justify-content:center; align-items:center; text-align:center;">
        <h1 style="color:red; font-size:50px;">ğŸš«</h1>
        <h2 style="color:white;">Ù„Ù‚Ø¯ ØªÙ… Ø­Ø¸Ø±Ùƒ Ù…Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹</h2>
        <p style="color:#777;">ØªÙ… Ø­Ø¸Ø± Ø­Ø³Ø§Ø¨Ùƒ Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©.</p>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ù…Ù†ÙØµÙ„Ø© Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø¸Ù‡ÙˆØ±) -->
    <div id="user-control-browser">
        <div class="ctrl-panel-header">
            <div><h2 id="ctrl-target-name" style="margin:0; color:var(--primary);">User</h2><span id="ctrl-target-id" style="font-size:10px; color:#aaa;">...</span></div>
            <button onclick="closeCtrlBrowser()" style="background:transparent; color:white; border:none; font-size:20px;">âŒ</button>
        </div>
        <div style="text-align:center; margin-bottom:20px;">Ø§Ù„Ø±ØµÙŠØ¯: <span id="ctrl-target-coins" style="color:gold; font-size:24px;">0</span></div>
        <input type="number" id="ctrl-amount-input" class="custom-input" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">
        <div class="action-grid">
            <button class="act-btn act-add" onclick="modifyTargetCoins(1)">â• Ø²ÙŠØ§Ø¯Ø© Ø¹Ù…Ù„Ø§Øª</button>
            <button class="act-btn act-sub" onclick="modifyTargetCoins(-1)">â– Ù†Ù‚Øµ Ø¹Ù…Ù„Ø§Øª</button>
            <button class="act-btn act-ban" onclick="banTargetUser()">ğŸš« Ø­Ø¸Ø± Ù†Ù‡Ø§Ø¦ÙŠ</button>
            <button class="act-btn act-freeze" onclick="freezeTargetUser()">â„ï¸ ØªØ¬Ù…ÙŠØ¯ (Freeze)</button>
            <button class="act-btn" style="background:cyan; color:black" onclick="unbanTargetUser()">âœ… ÙÙƒ Ø§Ù„Ø¹Ù‚ÙˆØ¨Ø©</button>
            <button class="act-btn act-mute" onclick="muteTargetUser()">ğŸ”‡ ÙƒØªÙ… (Mute)</button>
        </div>
    </div>

    <!-- ØªÙ†Ø¨ÙŠÙ‡ Ù„Ù„Ø¬Ù…ÙŠØ¹ -->
    <div id="global-alert-modal" class="modal">
        <div class="alert-box">
            <h1 style="color:red; font-size:40px;">âš ï¸ ØªÙ†Ø¨ÙŠÙ‡ Ù‡Ø§Ù…</h1>
            <p id="global-alert-text" style="font-size:20px; color:white;">...</p>
            <button class="btn-main" onclick="document.getElementById('global-alert-modal').style.display='none'">Ù…ÙˆØ§ÙÙ‚</button>
        </div>
    </div>

    <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø®Ø¨Ø§Ø± -->
    <div id="breaking-news-bar"><span id="breaking-text">...</span></div>

    <div class="header">
        <div>
            <button class="icon-btn" onclick="toggleSidebar()">â˜°</button>
            <button class="icon-btn" onclick="openSettings()">âš™ï¸</button>
        </div>
        <div class="user-badge">
            <img id="header-avatar" src="" class="user-avatar-small">
            <span id="user-display">Loading...</span>
        </div>
    </div>

    <!-- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© -->
    <div id="sidebar" class="sidebar">
        <button class="nav-btn" onclick="nav('home')">ğŸ  Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
        <button class="nav-btn" onclick="nav('games')" id="nav-games-btn">ğŸ® Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨</button>
        <button class="nav-btn" onclick="nav('leaderboard')" style="color:gold">ğŸ† Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ†</button>
        <button class="nav-btn" onclick="nav('global-chat')" style="color:#00d2d3">ğŸŒ Ø´Ø§Øª Ø¹Ø§Ù…</button>
        <button class="nav-btn" onclick="nav('bank')">ğŸ¦ Ø§Ù„Ø¨Ù†Ùƒ</button>
        <button class="nav-btn" onclick="nav('account')">ğŸ›’ Ø§Ù„Ù…ØªØ¬Ø±</button>
        <button class="nav-btn" onclick="nav('ads')">ğŸ“º ÙƒØ³Ø¨ Ø§Ù„Ø¹Ù…Ù„Ø§Øª</button>
        <button class="nav-btn" onclick="openSupport()" style="color:var(--primary)">
            ğŸ’¬ Ø§Ù„Ø¯Ø¹Ù…
            <div id="support-dot" class="notif-dot"></div>
        </button>
        <button class="nav-btn" onclick="toggleSidebar()" style="color:red;margin-top:auto">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>

    <!-- 1. Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <div id="home" class="page active">
        <div style="text-align:center; margin-top:20px;">
            <h1 id="site-title-display" style="font-size:3em; color:var(--primary); text-shadow: 2px 2px 0 #000;">YOYO V24</h1>
            <p id="site-welcome-display" style="color:#ddd">Ultra Edition ğŸš€</p>
            
            <button id="btn-daily" class="btn-main" style="background:linear-gradient(45deg, gold, orange); color:black; width:80%; margin-bottom:20px;" onclick="claimDaily()">ğŸ Ø§Ù„Ù…ÙƒØ§ÙØ£Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</button>
            <p id="streak-info" style="font-size:12px; color:gold; margin-top:-10px;">Ø£ÙŠØ§Ù… Ù…ØªØªØ§Ù„ÙŠØ©: <span id="streak-count">0</span></p>

            <div class="profile-card">
                <img id="card-avatar" src="" style="width:80px; height:80px; border-radius:50%; border:3px solid var(--primary); margin-bottom:10px;">
                <h3 style="color:var(--primary); margin:0;">ğŸ’³ Ù‡ÙˆÙŠØªÙƒ</h3>
                <!-- Bio & XP (Ø¬Ø¯ÙŠØ¯) -->
                <div class="bio-text" id="card-bio">...</div>
                <div class="xp-container"><div id="card-xp-bar" class="xp-bar"></div></div>
                <div style="font-size:10px; text-align:right; margin-bottom:10px;">XP: <span id="card-xp-val">0</span>/<span id="card-xp-max">100</span></div>

                <div style="background:#222; padding:10px; border-radius:5px; margin:10px 0; display:flex; justify-content:space-between;">
                    <strong id="card-id" style="color:white; font-family:monospace;">...</strong>
                    <button class="copy-btn" onclick="copyMyID()">Ù†Ø³Ø®</button>
                </div>
                <div>ğŸ’° Ø§Ù„Ø±ØµÙŠØ¯: <span id="card-coins" style="color:#0f0">...</span></div>
                <div style="margin-top:5px; color:#ff4757">â­ Ø§Ù„Ù…Ø³ØªÙˆÙ‰: <span id="card-level">1</span></div>
                <div id="card-clan" style="margin-top:5px; color:#8e44ad; font-weight:bold;"></div>
            </div>

            <button class="btn-main" style="width:200px" onclick="nav('games')" id="home-play-btn">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨</button>
        </div>
    </div>

    <!-- 2. Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ -->
    <div id="games" class="page">
        <h2>ğŸ® ØµØ§Ù„Ø© Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨</h2>
        
        <!-- Dice Game (Ø¬Ø¯ÙŠØ¯) -->
        <div class="game-card" style="border: 1px solid gold; background: linear-gradient(145deg, #332b00, #000);">
            <h3 style="color:gold;">ğŸ² Ù„Ø¹Ø¨Ø© Ø§Ù„Ø­Ø¸ (Ø§Ù„Ø²Ù‡Ø±)</h3>
            <p style="font-size:12px; color:#aaa">Ø±Ø§Ù‡Ù† ÙˆØªØ­Ø¯Ù‰ Ø­Ø¸Ùƒ! (Ø§Ù„Ø±Ø¨Ø­ x2)</p>
            <div style="display:flex; gap:5px; justify-content:center; margin-bottom:10px;">
                <input type="number" id="dice-bet" placeholder="Ù…Ø¨Ù„Øº Ø§Ù„Ø±Ù‡Ø§Ù†" style="width:100px; padding:5px; text-align:center;">
            </div>
            <button class="btn-main" style="background:gold; color:black;" onclick="rollDice()">Ø§Ø±Ù…ÙŠ Ø§Ù„Ù†Ø±Ø¯ ğŸ²</button>
            <div id="dice-result" style="margin-top:10px; font-weight:bold;"></div>
        </div>

        <!-- Battle Arena -->
        <div class="game-card" style="border: 2px solid #e74c3c; background: linear-gradient(145deg, #441111, #000);">
            <h3 style="color:#e74c3c; font-size:1.5em;">ğŸ”« BATTLE ARENA (1v1)</h3>
            <p style="color:#ddd;">Ù‚Ø§ØªÙ„ Ø®ØµÙ…Ùƒ ÙÙŠ Ø³Ø§Ø­Ø© Ø§Ù„Ù…Ø¹Ø±ÙƒØ©!</p>
            <p style="font-size:12px; color:gray">Ø­Ø±ÙŠØ© Ø§Ù„Ø­Ø±ÙƒØ©ØŒ Ø¥Ø·Ù„Ø§Ù‚ Ù†Ø§Ø±ØŒ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©</p>
            <button class="btn-main" style="background:#e74c3c; box-shadow: 0 4px 0 #c0392b;" onclick="openMultiplayerMenu()">ğŸ”¥ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø³Ø§Ø­Ø©</button>
        </div>

        <div class="games-grid">
            <div class="game-card"> <h3>ğŸ”® Ø§Ù„ØªØ®Ù…ÙŠÙ†</h3> <button class="btn-main" onclick="playGame(1)">Ù„Ø¹Ø¨</button> </div>
            <div class="game-card"> <h3>âœŠâœ‹ Ø­Ø¬Ø±Ø© ÙˆØ±Ù‚Ø©</h3> <button class="btn-main" onclick="playGame(2)">Ù„Ø¹Ø¨</button> </div>
        </div>
    </div>
    
    <!-- Maintenance MSG -->
    <div id="maintenance-msg" class="page" style="text-align:center; padding-top:100px;">
        <h1 style="font-size:50px; color:orange;">ğŸš§</h1>
        <h2>Ø§Ù„Ù†Ø¸Ø§Ù… ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø©</h2>
        <p>ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±ØŒ Ù†Ø­Ù† Ù†Ù‚ÙˆÙ… Ø¨ØªØ­Ø¯ÙŠØ«Ø§Øª Ù…Ù‡Ù…Ø©.</p>
    </div>

    <!-- Ø¨Ø§Ù‚ÙŠ Ø§Ù„ØµÙØ­Ø§Øª -->
    <div id="leaderboard" class="page">
        <h2 style="color:gold; text-align:center;">ğŸ† Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ†</h2>
        <div id="leaderboard-list">Loading...</div>
        <button class="btn-main" onclick="loadLeaderboard()">ğŸ”„ ØªØ­Ø¯ÙŠØ«</button>
    </div>

    <div id="global-chat" class="page">
        <h2 style="color:#00d2d3; text-align:center;">ğŸŒ Ø´Ø§Øª Ø§Ù„Ø¹Ø§Ù„Ù…</h2>
        <div id="gchat-area" class="chat-container"></div>
        <div style="display:flex; gap:5px; margin-top:10px;">
            <input type="text" id="gchat-input" placeholder="Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø¬Ù…ÙŠØ¹..." style="flex:1; padding:10px;">
            <button class="btn-main" style="width:auto; margin:0;" onclick="sendGlobalChat()">â¤</button>
        </div>
    </div>

    <div id="bank" class="page">
        <h2 style="text-align:center;">ğŸ¦ Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ</h2>
        <div class="room-box">
            <p>Ø±ØµÙŠØ¯Ùƒ: <span id="bank-balance" style="color:#0f0">0</span></p>
            <input type="text" id="trans-id" placeholder="ID Ø§Ù„Ù…Ø³ØªÙ„Ù…" style="width:90%; padding:10px; margin-bottom:10px;">
            <input type="number" id="trans-amount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº" style="width:90%; padding:10px; margin-bottom:10px;">
            <button class="btn-main" onclick="transferCoins()">Ø¥Ø±Ø³Ø§Ù„</button>
        </div>
        <div style="text-align:center; margin-top:20px;">
            <strong id="bank-my-id" style="color:var(--primary);">...</strong>
            <button class="copy-btn" onclick="copyMyID()">Ù†Ø³Ø®</button>
        </div>
    </div>

    <div id="account" class="page">
        <h2 id="lbl-store">ğŸ›’ Ø§Ù„Ù…ØªØ¬Ø±</h2>
        
        <!-- Promo Code Input -->
        <div style="background:#222; padding:10px; border-radius:10px; margin-bottom:20px; border:1px solid gold;">
            <h4 style="margin:0 0 10px 0; color:gold;">ğŸŸï¸ ÙƒÙˆØ¯ Ù‡Ø¯ÙŠØ©</h4>
            <div style="display:flex; gap:5px;">
                <input type="text" id="promo-code-input" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯ Ù‡Ù†Ø§" style="flex:1; padding:5px;">
                <button class="btn-main" style="width:auto; margin:0;" onclick="redeemCode()">Ø§Ø³ØªØ¨Ø¯Ø§Ù„</button>
            </div>
        </div>

        <!-- Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒÙ„Ø§Ù†Ø§Øª -->
        <div style="background:#2c2c54; padding:10px; border-radius:10px; margin-bottom:20px; border:1px solid #8e44ad;">
            <h4 style="margin:0 0 10px 0; color:#8e44ad;">ğŸ›¡ï¸ Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙ„Ø§Ù† (ÙØ±ÙŠÙ‚)</h4>
            <div style="display:flex; gap:5px;">
                <input type="text" id="clan-name-input" placeholder="Ø§Ø³Ù… Ø§Ù„ÙƒÙ„Ø§Ù† (3 Ø£Ø­Ø±Ù)" maxlength="3" style="flex:1; padding:5px;">
                <button class="btn-main" style="width:auto; margin:0; background:#8e44ad; color:white;" onclick="createClan()">Ø´Ø±Ø§Ø¡ (5000)</button>
            </div>
        </div>

        <h3 style="border-bottom:1px solid #333; padding-bottom:5px;">ğŸ¨ ØªÙ…ÙŠÙŠØ² Ø§Ù„Ø§Ø³Ù…</h3>
        <div style="display:flex; gap:10px; overflow-x:auto; padding-bottom:10px;">
            <button class="btn-main" style="color:gold; background:#333" onclick="buyColor('gold')">Ø°Ù‡Ø¨ÙŠ (<span id="price-gold">5000</span>)</button>
            <button class="btn-main" style="color:red; background:#333" onclick="buyColor('red')">Ø£Ø­Ù…Ø± (<span id="price-red">3000</span>)</button>
            <button class="btn-main" style="color:#0abde3; background:#333" onclick="buyColor('blue')">Ø³Ù…Ø§ÙˆÙŠ (<span id="price-blue">3000</span>)</button>
        </div>
        <div id="acc-lock" style="text-align:center; padding:30px; margin-top:20px; background:var(--card); border-radius:10px;">
            <p>VIP: <span id="price-vip">10000</span></p><button class="btn-main" onclick="buyAcc()">Ø´Ø±Ø§Ø¡</button>
        </div>
        <div id="acc-open" style="display:none; margin-top:20px; background:black; border:2px dashed red; padding:20px;">
            <h3>ğŸ”“ VIP UNLOCKED</h3><p style="color:#0f0">yoyo@vip.com | Pass: 2025</p>
        </div>
    </div>

    <div id="ads" class="page">
        <h2>ğŸ“º ÙƒØ³Ø¨ Ø§Ù„Ø¹Ù…Ù„Ø§Øª</h2>
        <div id="ad-timer" style="display:none; background:var(--primary); color:black; padding:10px;">Ø§Ù†ØªØ¸Ø±...</div>
        <button class="btn-main" onclick="watchAd(30,50)">Ø¥Ø¹Ù„Ø§Ù† 1 (+50)</button>
        <button class="btn-main" onclick="watchAd(60,100)">Ø¥Ø¹Ù„Ø§Ù† 2 (+100)</button>
    </div>

    <button class="float-btn" onclick="openSupport()">ğŸ’¬</button>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ù„Ø¹Ø¨ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ -->
    <div id="multiplayer-menu-modal" class="modal">
        <div class="modal-box">
            <h2 style="color:gold;">ğŸ”« BATTLE ARENA</h2>
            <div style="display:flex; gap:10px; justify-content:center;">
                <div style="flex:1; background:#333; padding:10px; border-radius:10px;">
                    <h4>Ø¥Ù†Ø´Ø§Ø¡</h4>
                    <button class="btn-main" onclick="createRoom()">Ø¥Ù†Ø´Ø§Ø¡</button>
                </div>
                <div style="flex:1; background:#333; padding:10px; border-radius:10px;">
                    <h4>Ø§Ù†Ø¶Ù…Ø§Ù…</h4>
                    <input type="number" id="room-code-input" placeholder="Ø§Ù„ÙƒÙˆØ¯" style="width:80%; padding:5px;">
                    <button class="btn-main" style="background:#00d2d3" onclick="joinRoom()">Ø¯Ø®ÙˆÙ„</button>
                </div>
            </div>
            <!-- Ø²Ø± Ù…Ø´Ø§Ù‡Ø¯Ø© -->
            <button class="btn-main" style="margin-top:10px; background:#aaa;" onclick="joinRoomSpectate()">ğŸ‘ï¸ Ù…Ø´Ø§Ù‡Ø¯Ø© Ù…Ø¨Ø§Ø±Ø§Ø©</button>
            <br><button class="btn-main" style="background:red" onclick="closeAll()">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© -->
    <div id="game-canvas-modal" class="modal">
        <div class="modal-box" style="width:100%; max-width:650px; padding:0; background:transparent; border:none; box-shadow:none;">
            <div style="background:#222; padding:5px; border-radius:10px 10px 0 0; display:flex; justify-content:space-between; align-items:center;">
                <span style="color:white; font-weight:bold; margin-right:10px;" id="game-status-display">...</span>
                <button style="background:red; border:none; color:white; padding:5px 10px; border-radius:5px;" onclick="exitGame()">Ø§Ù†Ø³Ø­Ø§Ø¨</button>
            </div>
            <div id="game-wrapper">
                <div class="score-board">
                    <div class="player-stat" style="border-color:#3498db"><span>P1</span><div class="hp-bar-mini"><div id="hp-p1" class="hp-val"></div></div></div>
                    <div class="player-stat" style="border-color:#e74c3c"><span>P2</span><div class="hp-bar-mini"><div id="hp-p2" class="hp-val"></div></div></div>
                </div>
                <canvas id="soccer-canvas" width="600" height="350"></canvas>
                
                <!-- ØªØ­ÙƒÙ… Joystick Ø§Ù„Ù…Ø­Ø³Ù† -->
                <div class="touch-controls" id="game-controls-ui">
                    <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¬ÙˆÙŠØ³ØªÙŠÙƒ -->
                    <div class="joystick-area" id="joystick-base">
                        <div class="joystick-knob" id="joystick-knob"></div>
                    </div>
                    <!-- Ø²Ø± Ø¥Ø·Ù„Ø§Ù‚ Ø§Ù„Ù†Ø§Ø± -->
                    <div class="action-btn"><div class="btn-fire" ontouchstart="fireBullet()" onclick="fireBullet()">ğŸ”¥</div></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„Ø§Øª -->
    <div id="user-chat-modal" class="modal"><div class="modal-box" style="height:80vh; display:flex; flex-direction:column;"><h3>ğŸ’¬ Ø§Ù„Ø¯Ø¹Ù…</h3><div id="user-chat-history" class="chat-container"></div><div style="display:flex; gap:5px; margin-top:10px;"><input type="text" id="user-chat-input" style="flex:1;"><button onclick="sendUserMsg()">â¤</button></div><button style="margin-top:10px;background:red;color:white;border:none;padding:10px" onclick="closeAll()">Ø¥ØºÙ„Ø§Ù‚</button></div></div>
    
    <div id="settings-modal" class="modal">
        <div class="modal-box">
            <h3>âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h3>
            <input id="input-name" placeholder="Name" style="width:90%; padding:10px;">
            <!-- Bio Input (Ø¬Ø¯ÙŠØ¯) -->
            <input id="input-bio" placeholder="Ø§ÙƒØªØ¨ Ù†Ø¨Ø°Ø© Ø¹Ù†Ùƒ (Bio)..." style="width:90%; padding:10px; margin-top:10px;">
            
            <button onclick="saveName()" style="margin-top:10px;">Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</button>
            <hr>
            <div id="avatar-selector" class="avatar-grid"></div>
            <button onclick="closeAll()">X</button>
        </div>
    </div>
    
    <!-- ************************************ -->
    <!-- ***** NEW ADMIN SYSTEM UI ***** -->
    <!-- ************************************ -->
    
    <button class="admin-trigger-btn" onclick="document.getElementById('admin-login-modal').style.display='flex'"></button>
    
    <div id="admin-login-modal" class="modal">
        <div class="modal-box" style="background:#111; max-width:300px;">
            <h3 style="color:red">ADMIN ACCESS</h3>
            <input type="password" id="adm-pass-input" placeholder="Password" style="width:90%; padding:10px; text-align:center;">
            <button class="btn-main" onclick="verifyAdmin()" style="margin-top:10px;">LOGIN</button>
        </div>
    </div>

    <div id="admin-main-panel" class="modal">
        <div class="modal-box" style="width:95%; max-width:900px; height:95vh; background:#000; padding:15px; position:relative; overflow:hidden;">
            
            <div class="adm-header">
                <button class="adm-nav-btn active" onclick="switchAdmTab('online')">ğŸ‘¥ Ø§Ù„Ù…ØªØµÙ„ÙŠÙ† (<span id="adm-online-count">0</span>)</button>
                <button class="adm-nav-btn" onclick="switchAdmTab('settings')">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
                <button class="adm-nav-btn" onclick="switchAdmTab('chatmon')">ğŸ’¬ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø´Ø§Øª</button>
                <button class="adm-nav-btn" onclick="switchAdmTab('logs')">ğŸ“œ Ø§Ù„Ø³Ø¬Ù„</button>
                <button class="adm-nav-btn" onclick="switchAdmTab('codes')">ğŸŸï¸ Ø£ÙƒÙˆØ§Ø¯</button>
                <button class="adm-nav-btn" onclick="switchAdmTab('game')">ğŸ® Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
                <button class="adm-nav-btn" onclick="switchAdmTab('shop')">ğŸ’° Ø§Ù„Ø£Ø³Ø¹Ø§Ø±</button>
                <button class="adm-nav-btn" onclick="switchAdmTab('support')">ğŸ’¬ Ø§Ù„Ø¯Ø¹Ù… <span id="global-support-badge" class="global-badge">0</span></button>
            </div>

            <!-- TAB 1: Ø§Ù„Ù…ØªØµÙ„ÙŠÙ† -->
            <div id="adm-tab-online" class="adm-section active">
                <!-- ÙˆØ¶Ø¹ Ø§Ù„Ø´Ø¨Ø­ -->
                <div style="background:#222; padding:10px; margin-bottom:10px; border-radius:5px; text-align:right;">
                    <label style="color:white; font-weight:bold;">ğŸ‘» ÙˆØ¶Ø¹ Ø§Ù„Ø´Ø¨Ø­ (Ghost Mode): </label>
                    <input type="checkbox" id="chk-ghost-mode" onchange="toggleGhostMode()">
                    <small style="color:#aaa; display:block;">ØªÙØ¹ÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ø®ÙŠØ§Ø± ÙŠØ®ÙÙŠ Ø­Ø§Ù„ØªÙƒ (Online) Ø¹Ù†Ø¯ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„.</small>
                </div>

                <div class="online-list-container" id="admin-online-list"></div>
                <!-- Ø²Ø± Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚ -->
                <div style="margin-top:10px; border-top:1px solid #333; padding-top:10px;">
                    <input type="text" id="popup-msg-input" placeholder="Ø±Ø³Ø§Ù„Ø© ØªÙ†Ø¨ÙŠÙ‡ Ù„Ù„Ø¬Ù…ÙŠØ¹..." style="width:70%; padding:8px;">
                    <button onclick="sendPopupAlert()" style="background:red; color:white; border:none; padding:8px;">ğŸ“¢ Ø¥Ø±Ø³Ø§Ù„ ØªÙ†Ø¨ÙŠÙ‡</button>
                </div>
            </div>

            <!-- TAB 2: Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ -->
            <div id="adm-tab-settings" class="adm-section">
                <div class="settings-grid">
                    <div class="setting-card"><label class="setting-label">Ø§Ø³Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹:</label><input type="text" id="set-site-title" class="custom-input"></div>
                    <div class="setting-card"><label class="setting-label">ØªØ±Ø­ÙŠØ¨:</label><input type="text" id="set-welcome-msg" class="custom-input"></div>
                    <div class="setting-card"><label class="setting-label">Ø§Ù„Ù„ÙˆÙ† (Theme):</label><input type="color" id="set-theme-color" class="color-picker" value="#00d2d3"></div>
                    <div class="setting-card"><label class="setting-label">Ø§Ù„Ù…ÙƒØ§ÙØ£Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©:</label><input type="number" id="set-daily-bonus" class="custom-input"></div>
                    <div class="setting-card" style="grid-column:span 2;"><label class="setting-label">Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø®Ø¨Ø§Ø±:</label><input type="text" id="set-breaking-news" class="custom-input"></div>
                    <div class="setting-card" style="grid-column:span 2;"><span style="color:red; font-weight:bold;">ÙˆØ¶Ø¹ Ø§Ù„ØµÙŠØ§Ù†Ø©</span> <input type="checkbox" id="set-maintenance"></div>
                    <button class="save-btn" onclick="saveSiteConfig()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
                </div>
            </div>

            <!-- TAB 3: Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø´Ø§Øª (Ø¬Ø¯ÙŠØ¯ ÙˆÙ…Ø­Ø³Ù†) -->
            <div id="adm-tab-chatmon" class="adm-section">
                <!-- Ø£Ø²Ø±Ø§Ø± Ø¥ØºÙ„Ø§Ù‚/ÙØªØ­ Ø§Ù„Ø´Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© -->
                <div style="display:flex; gap:10px; margin-bottom:10px; padding-bottom:10px; border-bottom:1px solid #333;">
                    <button class="btn-main" onclick="lockGlobalChat()" style="background:red; color:white;">ğŸ”’ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø´Ø§Øª Ù„Ù„Ø¬Ù…ÙŠØ¹</button>
                    <button class="btn-main" onclick="unlockGlobalChat()" style="background:green; color:white;">ğŸ”“ ÙØªØ­ Ø§Ù„Ø´Ø§Øª</button>
                </div>

                <div id="chat-monitor-area" class="chat-container" style="height:300px; margin-bottom:10px; background:#111;"></div>
                <button class="btn-main" onclick="clearGlobalChat()" style="background:red;">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ø´Ø§Øª Ø¨Ø§Ù„ÙƒØ§Ù…Ù„</button>
            </div>

            <!-- TAB 4: Ø³Ø¬Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª (Ø¬Ø¯ÙŠØ¯) -->
            <div id="adm-tab-logs" class="adm-section">
                <div style="height:350px; overflow-y:auto;">
                    <h4 style="color:var(--primary)">Ø³Ø¬Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª</h4>
                    <table class="adm-table">
                        <thead><tr><th>Ù…Ù†</th><th>Ø¥Ù„Ù‰</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>Ø§Ù„ÙˆÙ‚Øª</th></tr></thead>
                        <tbody id="logs-table-body"></tbody>
                    </table>
                    <h4 style="color:red; margin-top:20px;">Ø³Ø¬Ù„ Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø£Ø¯Ù…Ù†</h4>
                    <ul id="admin-actions-log" style="font-size:12px; color:#aaa; text-align:right;"></ul>
                </div>
            </div>

            <!-- TAB 5: Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ (Ø¬Ø¯ÙŠØ¯) -->
            <div id="adm-tab-codes" class="adm-section">
                <div style="display:flex; gap:5px; margin-bottom:10px;">
                    <input id="new-code-name" placeholder="Ø§Ù„ÙƒÙˆØ¯ (Ù…Ø«Ù„Ø§Ù‹ VIP)" style="flex:1;">
                    <input id="new-code-val" type="number" placeholder="Ø§Ù„Ù‚ÙŠÙ…Ø©" style="width:80px;">
                    <button onclick="createPromoCode()" style="background:gold; color:black;">â• Ø¥Ù†Ø´Ø§Ø¡</button>
                </div>
                <div id="codes-list" style="height:300px; overflow-y:auto;"></div>
            </div>

            <!-- TAB 6: ÙÙŠØ²ÙŠØ§Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø© (Ø¬Ø¯ÙŠØ¯) -->
            <div id="adm-tab-game" class="adm-section">
                <div class="settings-grid">
                    <div class="setting-card"><label class="setting-label">Ø³Ø±Ø¹Ø© Ø§Ù„Ù„Ø§Ø¹Ø¨:</label><input type="number" id="gm-speed" class="custom-input" value="3"></div>
                    <div class="setting-card"><label class="setting-label">Ø¶Ø±Ø± Ø§Ù„Ø±ØµØ§ØµØ©:</label><input type="number" id="gm-dmg" class="custom-input" value="10"></div>
                    <div class="setting-card"><label class="setting-label">Ù†Ù‚Ø§Ø· Ø§Ù„Ø­ÙŠØ§Ø© (HP):</label><input type="number" id="gm-hp" class="custom-input" value="100"></div>
                    <button class="save-btn" onclick="saveGameConfig()">ğŸ’¾ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù„Ø¹Ø¨Ø©</button>
                </div>
            </div>

            <!-- TAB 7: Ø§Ù„Ø£Ø³Ø¹Ø§Ø± (Ø¬Ø¯ÙŠØ¯) -->
            <div id="adm-tab-shop" class="adm-section">
                <div class="settings-grid">
                    <div class="setting-card"><label class="setting-label">Ø³Ø¹Ø± Ø§Ù„Ø°Ù‡Ø¨ÙŠ:</label><input type="number" id="shp-gold" class="custom-input"></div>
                    <div class="setting-card"><label class="setting-label">Ø³Ø¹Ø± Ø§Ù„Ø£Ø­Ù…Ø±:</label><input type="number" id="shp-red" class="custom-input"></div>
                    <div class="setting-card"><label class="setting-label">Ø³Ø¹Ø± Ø§Ù„Ø³Ù…Ø§ÙˆÙŠ:</label><input type="number" id="shp-blue" class="custom-input"></div>
                    <div class="setting-card"><label class="setting-label">Ø³Ø¹Ø± VIP:</label><input type="number" id="shp-vip" class="custom-input"></div>
                    <button class="save-btn" onclick="saveShopConfig()">ğŸ’¾ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø³Ø¹Ø§Ø±</button>
                </div>
            </div>

            <!-- TAB 8: Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ -->
            <div id="adm-tab-support" class="adm-section">
                <div class="support-layout">
                    <div class="support-list" id="support-users-list">Loading...</div>
                    <div class="support-chat-view">
                        <div id="adm-chat-header" style="padding:10px; border-bottom:1px solid #333; font-weight:bold;">Ø§Ø®ØªØ± Ù…Ø³ØªØ®Ø¯Ù…</div>
                        <div id="adm-chat-box" class="chat-container" style="flex:1; background:#111; height:calc(100% - 80px);"></div>
                        <div style="display:flex; gap:5px; margin-top:5px;">
                            <input id="adm-chat-reply" style="flex:1;" placeholder="Ø§Ù„Ø±Ø¯...">
                            <button class="btn-main" style="width:50px; margin:0;" onclick="sendAdminReply()">â¤</button>
                        </div>
                    </div>
                </div>
            </div>

            <button onclick="closeAll()" style="position:absolute; bottom:10px; left:10px; background:red; color:white; padding:10px 30px; border:none; border-radius:5px;">Ø®Ø±ÙˆØ¬</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getDatabase, ref, set, onValue, push, update, get, onDisconnect, remove, query, orderByChild, limitToLast, off } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCdQfqqUY0aIUtsHQcGrlUdvsN_znvvGYk",
            authDomain: "yoyogames-efd5b.firebaseapp.com",
            databaseURL: "https://yoyogames-efd5b-default-rtdb.firebaseio.com",
            projectId: "yoyogames-efd5b",
            storageBucket: "yoyogames-efd5b.firebasestorage.app",
            messagingSenderId: "1056937637926",
            appId: "1:1056937637926:web:bbbe7648cf4575b144cee7"
        };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        window.playSound = (id) => { const a=document.getElementById('snd-'+id); if(a){a.currentTime=0; a.play().catch(e=>{});} }

        // --- Ø¯Ø§Ù„Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (Toast) ---
        window.showToast = (msg, type='info') => {
            const container = document.getElementById('toast-container');
            const div = document.createElement('div');
            div.className = `toast ${type}`;
            let icon = 'â„¹ï¸';
            if(type==='success') icon = 'âœ…';
            if(type==='error') icon = 'âŒ';
            
            div.innerHTML = `<span>${icon}</span> ${msg}`;
            container.appendChild(div);
            playSound('click'); 

            setTimeout(() => {
                div.style.opacity = '0';
                setTimeout(() => div.remove(), 300);
            }, 3000);
        }

        let myID = localStorage.getItem('yoyo_uid');
        if(!myID) { myID = 'U-' + Math.floor(100000 + Math.random() * 900000); localStorage.setItem('yoyo_uid', myID); }
        
        let myData = { name: "Player", coins: 0, bought: false, avatar: "0", color: "white", lastBonus: 0, streak: 0, level: 1, xp: 0, maxXp: 100, bio: "", mutedUntil: 0, frozen: false, clan: "", usedCodes: {}, banned: false };
        let currentDailyBonus = 200;
        let lastChatTime = 0; 
        let isGhostMode = localStorage.getItem('adm_ghost') === 'true';
        let myRef = null; // Changed to var for updates

        // Admin State
        let isAdminLoggedIn = false;
        let isChatLocked = false;
        const adminAvatarUrl = "https://cdn-icons-png.flaticon.com/512/2942/2942813.png"; 

        // Default Configs
        let shopPrices = { gold: 5000, red: 3000, blue: 3000, vip: 10000 };
        let gameConfig = { speed: 3, dmg: 10, hp: 100 };

        const avatarList = [
            "https://api.dicebear.com/7.x/avataaars/svg?seed=Felix",
            "https://api.dicebear.com/7.x/avataaars/svg?seed=Aneka",
            "https://api.dicebear.com/7.x/bottts/svg?seed=1",
            "https://api.dicebear.com/7.x/bottts/svg?seed=2"
        ];

        // Connection & Ghost Mode Logic
        onValue(ref(db, ".info/connected"), (s) => { 
            if(s.val()) { 
                document.getElementById('loading-screen').style.opacity = '0';
                setTimeout(()=> document.getElementById('loading-screen').style.display='none', 500);

                if(!isGhostMode) {
                    set(ref(db,"onlineUsers/"+myID), { time: Date.now() }); 
                    onDisconnect(ref(db,"onlineUsers/"+myID)).remove(); 
                }
            } 
        });

        // SITE CONFIG LISTENER
        onValue(ref(db, 'siteConfig'), (snap) => {
            const config = snap.val();
            if(config) {
                if(config.title) document.getElementById('site-title-display').innerText = config.title;
                if(config.welcomeMsg) document.getElementById('site-welcome-display').innerText = config.welcomeMsg;
                if(config.themeColor) document.documentElement.style.setProperty('--primary', config.themeColor);
                if(config.dailyBonus) currentDailyBonus = parseInt(config.dailyBonus);
                
                if(config.chatLocked !== undefined) isChatLocked = config.chatLocked;

                const newsBar = document.getElementById('breaking-news-bar');
                if(config.breakingNews && config.breakingNews.trim() !== "") { newsBar.style.display = 'block'; document.getElementById('breaking-text').innerText = config.breakingNews; } else newsBar.style.display = 'none';

                if(config.maintenance === true) { document.getElementById('games').style.display = 'none'; document.getElementById('maintenance-msg').style.display = 'block'; document.getElementById('nav-games-btn').style.display = 'none'; document.getElementById('home-play-btn').style.display = 'none'; closeAll(); } 
                else { document.getElementById('maintenance-msg').style.display = 'none'; document.getElementById('nav-games-btn').style.display = 'block'; document.getElementById('home-play-btn').style.display = 'inline-block'; }

                if(config.game) gameConfig = config.game;
                
                if(config.shop) {
                    shopPrices = config.shop;
                    document.getElementById('price-gold').innerText = shopPrices.gold;
                    document.getElementById('price-red').innerText = shopPrices.red;
                    document.getElementById('price-blue').innerText = shopPrices.blue;
                    document.getElementById('price-vip').innerText = shopPrices.vip;
                }

                if(config.popupAlert && config.popupAlert.time > (myData.lastPopupSeen || 0)) {
                    document.getElementById('global-alert-text').innerText = config.popupAlert.msg;
                    document.getElementById('global-alert-modal').style.display = 'flex';
                    myData.lastPopupSeen = config.popupAlert.time; 
                    saveToServer(); 
                }
            }
        });

        // ØªÙ… ØªØºÙ„ÙŠÙ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø¯Ø§Ù„Ø© Ù„ÙŠØ¹Ù…Ù„ Ù…Ø¹ Ø¬ÙˆØ¬Ù„
        function connectUser() {
            if(myRef) off(myRef); // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ø§Ù„Ù‚Ø¯ÙŠÙ… Ø¥Ø°Ø§ ÙˆØ¬Ø¯
            myRef = ref(db, 'users/' + myID);
            
            // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† Ø¨Ø§Ù„Ù…Ø¹Ø±Ù Ø§Ù„Ø¬Ø¯ÙŠØ¯
            if(!isGhostMode) {
                set(ref(db,"onlineUsers/"+myID), { time: Date.now() }); 
                onDisconnect(ref(db,"onlineUsers/"+myID)).remove(); 
            }

            onValue(myRef, (snapshot) => {
                const data = snapshot.val();
                if(data) {
                    myData = { ...myData, ...data };
                    // Ensure new fields exist
                    if(!myData.xp) myData.xp = 0;
                    if(!myData.maxXp) myData.maxXp = 100;
                    if(!myData.bio) myData.bio = "";
                    
                    updateUI();
                    
                    if(myData.banned === true) {
                        document.getElementById('banned-screen').style.display = 'flex';
                        return;
                    } else {
                        document.getElementById('banned-screen').style.display = 'none';
                    }

                    if(data.alert) { showToast(data.alert, "info"); update(myRef, {alert: null}); }
                    if(data.kick) { alert("â›” Ù„Ù‚Ø¯ ØªÙ… Ø·Ø±Ø¯Ùƒ"); update(myRef, {kick:null}); window.location.reload(); }
                    
                    if(data.messages) {
                    if(document.getElementById('user-chat-modal').style.display === 'flex') renderChat(document.getElementById('user-chat-history'), data.messages);
                    }
                } else update(myRef, myData);
            });
        }
        
        // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„ Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ø£Ù†Ù†Ø§ Ø£Ù„ØºÙŠÙ†Ø§ Ø¬ÙˆØ¬Ù„
        connectUser();

        // Chat
        const gChatRef = ref(db, 'globalChat');
        onValue(query(gChatRef, limitToLast(50)), (snap) => {
            const div = document.getElementById('gchat-area'); div.innerHTML = '';
            snap.forEach(child => {
                const m = child.val();
                const d = document.createElement('div');
                const isMe = m.senderID === myID;
                d.className = `msg-bubble ${isMe ? 'chat-mine' : 'chat-other'}`;
                
                let nameClass = "";
                if(m.color === 'gold') nameClass = "name-gold";
                else if(m.color === 'red') nameClass = "name-red";
                else if(m.color === 'blue') nameClass = "name-blue";
                
                let badgeHTML = "";
                if(m.isAdmin) badgeHTML += `<span class="admin-badge">ADMIN</span>`;
                else if(m.vip) badgeHTML += `<span class="vip-badge">VIP</span>`;
                if(m.clan) badgeHTML += `<span class="clan-badge">${m.clan}</span>`; 

                d.innerHTML = `<div style="font-size:10px; opacity:0.7;">
                    <img src="${m.avatar}" style="width:15px; height:15px; border-radius:50%; vertical-align:middle; border:1px solid #777;"> 
                    ${badgeHTML} <span class="${nameClass}">${m.name}</span>
                </div>${m.text}`;
                div.appendChild(d);
            });
            div.scrollTop = div.scrollHeight;
        });

        function updateUI() {
            const avUrl = avatarList[parseInt(myData.avatar) || 0] || avatarList[0];
            document.getElementById('header-avatar').src = avUrl;
            document.getElementById('user-display').innerText = `${myData.name} | ğŸ’°${myData.coins}`;
            document.getElementById('card-avatar').src = avUrl;
            document.getElementById('card-id').innerText = myID;
            document.getElementById('card-coins').innerText = myData.coins;
            document.getElementById('card-level').innerText = myData.level;
            
            // Bio & XP Update
            document.getElementById('card-bio').innerText = myData.bio || "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ø¨Ø°Ø©...";
            document.getElementById('card-xp-val').innerText = myData.xp;
            document.getElementById('card-xp-max').innerText = myData.maxXp;
            const xpPercent = Math.min((myData.xp / myData.maxXp) * 100, 100);
            document.getElementById('card-xp-bar').style.width = xpPercent + "%";

            // Clan Display
            const clanDiv = document.getElementById('card-clan');
            if(myData.clan) clanDiv.innerText = `ğŸ›¡ï¸ Clan: [${myData.clan}]`;
            else clanDiv.innerText = "";

            document.getElementById('bank-balance').innerText = myData.coins;
            document.getElementById('bank-my-id').innerText = myID;
            if(myData.bought) { document.getElementById('acc-lock').style.display = 'none'; document.getElementById('acc-open').style.display = 'block'; }
            
            document.getElementById('streak-count').innerText = myData.streak || 0;
            
            checkDailyBtn();
        }
        window.saveToServer = () => update(myRef, { name: myData.name, coins: myData.coins, bought: myData.bought, avatar: myData.avatar, color: myData.color, lastBonus: myData.lastBonus, streak: myData.streak, level: myData.level, xp: myData.xp, maxXp: myData.maxXp, bio: myData.bio, clan: myData.clan || "" });

        const avGrid = document.getElementById('avatar-selector'); avGrid.innerHTML = '';
        avatarList.forEach((url, idx) => {
            const img = document.createElement('img'); img.src = url; img.className = 'avatar-option';
            img.onclick = () => { myData.avatar = idx.toString(); saveToServer(); showToast("ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ø£ÙØ§ØªØ§Ø±!", "success"); };
            avGrid.appendChild(img);
        });

        // --- Ù†Ø¸Ø§Ù… Ø§Ù„Ù€ XP (Ø¬Ø¯ÙŠØ¯) ---
        function addXP(amount) {
            myData.xp += amount;
            if(myData.xp >= myData.maxXp) {
                myData.xp -= myData.maxXp;
                myData.level++;
                myData.maxXp = Math.floor(myData.maxXp * 1.2); // Ø£ØµØ¹Ø¨ ÙƒÙ„ Ù…Ø±Ø©
                showToast(`ğŸ†™ Ù…Ø¨Ø±ÙˆÙƒ! ÙˆØµÙ„Øª Ù„Ù„Ù…Ø³ØªÙˆÙ‰ ${myData.level}`, 'success');
                playSound('win');
            }
            saveToServer();
        }

        window.claimDaily = () => {
            if(myData.frozen) return showToast("â„ï¸ Ø­Ø³Ø§Ø¨Ùƒ Ù…Ø¬Ù…Ø¯", "error");
            const now = Date.now();
            const last = myData.lastBonus || 0;
            const diff = now - last;
            
            if(diff >= 86400000) { 
                if(diff < 172800000) { 
                    myData.streak = (myData.streak || 0) + 1;
                } else {
                    myData.streak = 1; 
                }
                
                let bonus = currentDailyBonus + (myData.streak * 10); 
                if(bonus > 500) bonus = 500; 

                myData.coins += bonus; 
                myData.lastBonus = now; 
                addXP(50); // XP bonus
                saveToServer(); 
                playSound('win'); 
                showToast(`ğŸ +${bonus} Ø¹Ù…Ù„Ø©! (Streak: ${myData.streak})`, "success");
            } else showToast("â³ Ø¹Ø¯ Ù„Ø§Ø­Ù‚Ø§Ù‹", "info");
        }
        function checkDailyBtn() { const btn = document.getElementById('btn-daily'); if(Date.now() - (myData.lastBonus||0) >= 86400000) btn.style.filter = "brightness(1.2)"; else btn.style.filter = "grayscale(1)"; }

        window.copyMyID = () => navigator.clipboard.writeText(myID).then(()=>showToast("ØªÙ… Ø§Ù„Ù†Ø³Ø®", "success")).catch(()=>prompt("Ø§Ù„Ù†Ø³Ø®:",myID));
        
        // Transfer
        window.transferCoins = () => {
            if(myData.frozen) return showToast("â„ï¸ Ø­Ø³Ø§Ø¨Ùƒ Ù…Ø¬Ù…Ø¯ Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªØ­ÙˆÙŠÙ„", "error");
            const tid=document.getElementById('trans-id').value.trim(), amt=parseInt(document.getElementById('trans-amount').value);
            if(!tid||!amt) return showToast("Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ø§Ø·Ø¦Ø©", "error"); 
            if(myData.coins<amt) return showToast("Ø±ØµÙŠØ¯ ØºÙŠØ± ÙƒØ§ÙÙŠ", "error");
            get(ref(db,'users/'+tid)).then(s=>{
                if(s.exists()){ 
                    myData.coins-=amt; saveToServer(); 
                    update(ref(db,'users/'+tid), { coins:(s.val().coins||0)+amt, alert:`ğŸ’¸ ÙˆØµÙ„Ùƒ ${amt} Ù…Ù† ${myData.name}` }); 
                    push(ref(db, 'logs/transactions'), { from: myData.name, to: s.val().name, amount: amt, time: Date.now() });
                    showToast("ØªÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!", "success"); 
                } else showToast("ID Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯", "error");
            });
        }
        
        window.loadLeaderboard = () => {
            document.getElementById('leaderboard-list').innerHTML = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...';
            get(query(ref(db, 'users'), orderByChild('coins'))).then(snap => {
                let users = []; snap.forEach(c => users.push(c.val()));
                users.sort((a,b) => b.coins - a.coins);
                const list = document.getElementById('leaderboard-list'); list.innerHTML = '';
                users.slice(0, 5).forEach((u, i) => {
                    const div = document.createElement('div'); div.className = 'leader-item';
                    div.innerHTML = `<div style="display:flex; align-items:center; gap:10px;"><div class="rank-badge">${i+1}</div><span>${u.name}</span></div><span style="color:#0f0;">${u.coins}</span>`;
                    list.appendChild(div);
                });
            });
        }

        window.buyColor = (colName) => { 
            let price = shopPrices[colName];
            if(!price) return showToast("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø³Ø¹Ø±", "error");
            if(myData.coins >= price) { 
                if(confirm(`Ø´Ø±Ø§Ø¡ Ø§Ù„Ù„ÙˆÙ† Ø¨Ù€ ${price} Ø¬ÙˆÙ‡Ø±Ø©ØŸ`)) { 
                    myData.coins -= price; myData.color = colName; saveToServer(); showToast("ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù„ÙˆÙ† Ø¨Ù†Ø¬Ø§Ø­!", "success"); 
                } 
            } else { showToast("Ø±ØµÙŠØ¯Ùƒ ØºÙŠØ± ÙƒØ§ÙÙŠ!", "error"); }
        }

        window.createClan = () => {
            const name = document.getElementById('clan-name-input').value.toUpperCase();
            if(!name || name.length !== 3) return showToast("Ø§Ù„Ø§Ø³Ù… ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† 3 Ø£Ø­Ø±Ù", "error");
            const price = 5000;
            if(myData.coins < price) return showToast("ØªØ­ØªØ§Ø¬ 5000 Ø¹Ù…Ù„Ø©", "error");
            if(myData.clan) return showToast("Ø£Ù†Øª Ø¨Ø§Ù„ÙØ¹Ù„ ÙÙŠ ÙƒÙ„Ø§Ù†", "error");

            if(confirm(`Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙ„Ø§Ù† [${name}] Ø¨Ù€ 5000ØŸ`)) {
                myData.coins -= price;
                myData.clan = name;
                saveToServer();
                showToast("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙƒÙ„Ø§Ù†!", "success");
            }
        }
        
        // Chat with XP
        window.sendGlobalChat = () => { 
            if(myData.frozen) return showToast("â„ï¸ Ø­Ø³Ø§Ø¨Ùƒ Ù…Ø¬Ù…Ø¯", "error");
            if(isChatLocked && !isAdminLoggedIn) {
                showToast("â›” Ø§Ù„Ø´Ø§Øª Ù…ØºÙ„Ù‚ Ù…Ø¤Ù‚ØªØ§Ù‹", "error");
                return;
            }
            if(myData.mutedUntil && Date.now() < myData.mutedUntil) return showToast("ğŸ”‡ Ø£Ù†Øª Ù…ÙƒØªÙˆÙ… Ù…Ø¤Ù‚ØªØ§Ù‹", "error");
            
            if(Date.now() - lastChatTime < 2000) return showToast("â³ ØªÙ…Ù‡Ù„ Ù‚Ù„ÙŠÙ„Ø§Ù‹", "info");
            lastChatTime = Date.now();

            const t = document.getElementById('gchat-input').value; if(!t) return; 
            
            // Add slight XP for chatting
            addXP(2); 

            let currentAvatar = isAdminLoggedIn ? adminAvatarUrl : avatarList[myData.avatar||0];
            push(gChatRef, { senderID: myID, name: myData.name, avatar: currentAvatar, color: myData.color || 'white', text: t, vip: myData.bought, isAdmin: isAdminLoggedIn, clan: myData.clan || "" }); 
            document.getElementById('gchat-input').value = ''; 
        }
        
        window.sendUserMsg = () => { let t = document.getElementById('user-chat-input').value; if(!t) return; push(ref(db,'users/'+myID+'/messages'), { sender: 'user', text: t, timestamp: Date.now() }); document.getElementById('user-chat-input').value = ''; showToast("ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„", "success"); }
        
        window.playGame = (i) => { showToast("Ù‚Ø±ÙŠØ¨Ø§Ù‹", "info"); }

        // --- Dice Game Logic (Ø¬Ø¯ÙŠØ¯) ---
        window.rollDice = () => {
            const betInput = document.getElementById('dice-bet');
            const bet = parseInt(betInput.value);
            const resDiv = document.getElementById('dice-result');

            if(!bet || bet <= 0) return showToast("Ø£Ø¯Ø®Ù„ Ù…Ø¨Ù„Øº Ø±Ù‡Ø§Ù† ØµØ­ÙŠØ­", "error");
            if(myData.coins < bet) return showToast("Ø±ØµÙŠØ¯Ùƒ ØºÙŠØ± ÙƒØ§ÙÙŠ!", "error");

            resDiv.innerText = "ğŸ² Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±Ù…ÙŠ...";
            
            setTimeout(() => {
                const userRoll = Math.floor(Math.random() * 6) + 1;
                const botRoll = Math.floor(Math.random() * 6) + 1;

                if(userRoll > botRoll) {
                    myData.coins += bet;
                    addXP(10);
                    saveToServer();
                    playSound('win');
                    resDiv.innerHTML = `<span style="color:#2ecc71">ÙØ²Øª! (Ø£Ù†Øª: ${userRoll} | Ù‡Ùˆ: ${botRoll}) +${bet}</span>`;
                    showToast(`Ù…Ø¨Ø±ÙˆÙƒ! Ø±Ø¨Ø­Øª ${bet} Ø¹Ù…Ù„Ø©`, "success");
                } else if (userRoll < botRoll) {
                    myData.coins -= bet;
                    saveToServer();
                    resDiv.innerHTML = `<span style="color:#e74c3c">Ø®Ø³Ø±Øª! (Ø£Ù†Øª: ${userRoll} | Ù‡Ùˆ: ${botRoll}) -${bet}</span>`;
                    showToast(`Ø­Ø¸ Ø£ÙˆÙØ±! Ø®Ø³Ø±Øª ${bet}`, "error");
                } else {
                    resDiv.innerHTML = `<span style="color:gray">ØªØ¹Ø§Ø¯Ù„! (Ø§Ø³ØªØ¹Ø¯Øª Ù…Ø§Ù„Ùƒ)</span>`;
                    showToast("ØªØ¹Ø§Ø¯Ù„!", "info");
                }
            }, 1000);
        }
        
        window.redeemCode = () => {
            const code = document.getElementById('promo-code-input').value.trim();
            if(!code) return;
            if(myData.usedCodes && myData.usedCodes[code]) { return showToast("â›” Ù„Ù‚Ø¯ Ø§Ø³ØªØ®Ø¯Ù…Øª Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ø³Ø§Ø¨Ù‚Ø§Ù‹!", "error"); }
            get(ref(db, 'promoCodes/'+code)).then(snap => {
                if(snap.exists()) {
                    get(ref(db, 'users/'+myID+'/usedCodes/'+code)).then(usedSnap => {
                        if(usedSnap.exists()) { showToast("â›” Ù„Ù‚Ø¯ Ø§Ø³ØªØ®Ø¯Ù…Øª Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ø³Ø§Ø¨Ù‚Ø§Ù‹!", "error"); } else {
                            const val = snap.val(); myData.coins += parseInt(val.value); update(ref(db, 'users/'+myID+'/usedCodes'), { [code]: true }); saveToServer(); showToast(`ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ! Ø±Ø¨Ø­Øª ${val.value} Ø¹Ù…Ù„Ø©`, "success");
                        }
                    });
                } else showToast("ÙƒÙˆØ¯ Ø®Ø§Ø·Ø¦", "error");
            });
        }

        /* =======================================================
           ENGINE V24: BATTLE ARENA
           ======================================================= */
        const canvas = document.getElementById('soccer-canvas');
        const ctx = canvas.getContext('2d');
        const WIDTH = 600, HEIGHT = 350;
        let currentRoomId = null, myRole = null, gameInterval = null;
        let lastNetUpdate = 0;
        let joystick = { active: false, dx: 0, dy: 0 };
        const p1 = { x: 50, y: 175, hp: 100, color: '#3498db', avatar: 0, lastShot: 0 };
        const p2 = { x: 550, y: 175, hp: 100, color: '#e74c3c', avatar: 0, lastShot: 0 };
        let bullets = []; 
        let powerups = []; 
        const obstacles = [{x: 200, y: 100, w: 40, h: 150},{x: 360, y: 100, w: 40, h: 150}];
        const avatarImgs = [];
        avatarList.forEach(src => { const i = new Image(); i.src=src; avatarImgs.push(i); });

        window.openMultiplayerMenu = () => document.getElementById('multiplayer-menu-modal').style.display = 'flex';
        
        window.createRoom = () => {
            if(myData.frozen) return showToast("â„ï¸ Ù…Ø¬Ù…Ø¯", "error");
            const code = Math.floor(1000 + Math.random() * 9000); currentRoomId = code; myRole = 'p1';
            set(ref(db, 'arena/' + code), { p1: { x:50, y:175, hp: gameConfig.hp, avatar: myData.avatar, shoot: 0 }, p2: { x:550, y:175, hp: gameConfig.hp, avatar: "0", shoot: 0 }, powerups: [] });
            onDisconnect(ref(db, 'arena/' + code)).remove();
            startArenaGame(code);
        };
        
        window.joinRoom = () => {
            if(myData.frozen) return showToast("â„ï¸ Ù…Ø¬Ù…Ø¯", "error");
            const code = document.getElementById('room-code-input').value;
            get(ref(db, 'arena/' + code)).then(snap => {
                if(snap.exists()) { currentRoomId = code; myRole = 'p2'; update(ref(db, `arena/${code}/p2`), { avatar: myData.avatar }); startArenaGame(code); } else showToast("Ø§Ù„ØºØ±ÙØ© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©", "error");
            });
        };

        window.joinRoomSpectate = () => {
            const code = document.getElementById('room-code-input').value;
            get(ref(db, 'arena/' + code)).then(snap => {
                if(snap.exists()) { 
                    currentRoomId = code; 
                    myRole = 'spectator'; 
                    startArenaGame(code); 
                    showToast("ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© ğŸ‘€", "info");
                } else showToast("Ø§Ù„ØºØ±ÙØ© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©", "error");
            });
        };

        function startArenaGame(code) {
            closeAll(); document.getElementById('game-canvas-modal').style.display = 'flex'; document.getElementById('game-status-display').innerText = `ØºØ±ÙØ©: ${code}`;
            p1.x=50; p1.y=175; p1.hp=gameConfig.hp; p2.x=550; p2.y=175; p2.hp=gameConfig.hp; bullets=[]; powerups=[];
            if(myRole === 'spectator') document.getElementById('game-controls-ui').style.display = 'none';
            else document.getElementById('game-controls-ui').style.display = 'flex';
            gameInterval = setInterval(() => { updateArenaPhysics(); drawArenaGame(); syncNetwork(); }, 1000/60);
            onValue(ref(db, `arena/${code}`), (snap) => {
                const val = snap.val(); if(!val) return;
                if(myRole !== 'p1') { p1.targetX = val.p1.x; p1.targetY = val.p1.y; p1.hp = val.p1.hp; p1.avatar = val.p1.avatar; if(val.p1.shoot > p1.lastShot) { spawnBullet('p1'); p1.lastShot = val.p1.shoot; } } 
                if (myRole !== 'p2') { p2.targetX = val.p2.x; p2.targetY = val.p2.y; p2.hp = val.p2.hp; p2.avatar = val.p2.avatar; if(val.p2.shoot > p2.lastShot) { spawnBullet('p2'); p2.lastShot = val.p2.shoot; } }
                if(val.powerups) powerups = val.powerups; else powerups = [];
                const max = gameConfig.hp;
                document.getElementById('hp-p1').style.width = (p1.hp/max)*100 + '%'; document.getElementById('hp-p2').style.width = (p2.hp/max)*100 + '%';
                if(p1.hp <= 0 || p2.hp <= 0) endGame();
            });
            initJoystick(); 
        }
        
        window.fireBullet = () => { 
            if(myRole === 'spectator') return;
            const now = Date.now(); const me = myRole === 'p1' ? p1 : p2; 
            if(now - me.lastShot > 400) { spawnBullet(myRole); me.lastShot = now; update(ref(db, `arena/${currentRoomId}/${myRole}/shoot`), now); } 
        }
        function spawnBullet(role) { playSound('shot'); const shooter = role==='p1'?p1:p2; const dir = role==='p1'?1:-1; bullets.push({ x: shooter.x + (20*dir), y: shooter.y, vx: 10*dir, vy: 0, owner: role }); }
        
        function checkSpawnPowerup() {
            if(myRole === 'p1' && Math.random() < 0.005 && powerups.length < 2) {
                const type = Math.random() > 0.5 ? 1 : 2; 
                const newPu = { x: 200 + Math.random()*200, y: 50 + Math.random()*250, type: type, id: Date.now() };
                powerups.push(newPu);
                update(ref(db, `arena/${currentRoomId}/powerups`), powerups);
            }
        }

        function updateArenaPhysics() {
            checkSpawnPowerup();
            const me = myRole === 'p1' ? p1 : p2; 
            if(myRole !== 'spectator') {
                const speed = parseInt(gameConfig.speed); 
                let dx = 0, dy = 0; 
                if(joystick.active) { dx = joystick.dx * speed; dy = joystick.dy * speed; }
                if(me.x + dx > 10 && me.x + dx < WIDTH - 10) me.x += dx; 
                if(me.y + dy > 10 && me.y + dy < HEIGHT - 10) me.y += dy;
                obstacles.forEach(o => { if(me.x > o.x - 10 && me.x < o.x + o.w + 10 && me.y > o.y - 10 && me.y < o.y + o.h + 10) { me.x -= dx; me.y -= dy; } });
                powerups.forEach((pu, idx) => {
                    const dist = Math.sqrt((me.x - pu.x)**2 + (me.y - pu.y)**2);
                    if(dist < 20) {
                        playSound('win'); 
                        if(pu.type === 1) me.hp = Math.min(me.hp + 20, parseInt(gameConfig.hp));
                        powerups.splice(idx, 1);
                        if(myRole === 'p1') update(ref(db, `arena/${currentRoomId}/p1/hp`), me.hp);
                        else update(ref(db, `arena/${currentRoomId}/p2/hp`), me.hp);
                        update(ref(db, `arena/${currentRoomId}/powerups`), powerups);
                    }
                });
            }
            const opp = myRole === 'p1' ? p2 : p1; if(opp.targetX !== undefined) { opp.x += (opp.targetX - opp.x) * 0.2; opp.y += (opp.targetY - opp.y) * 0.2; }
            const p1Obj = myRole === 'p1' ? p1 : p2;
            if(myRole === 'spectator' && p1.targetX !== undefined) { p1.x += (p1.targetX - p1.x) * 0.2; p1.y += (p1.targetY - p1.y) * 0.2; }
            for(let i = bullets.length - 1; i >= 0; i--) { let b = bullets[i]; b.x += b.vx; b.y += b.vy; const target = b.owner === 'p1' ? p2 : p1; const dist = Math.sqrt((b.x - target.x)**2 + (b.y - target.y)**2); if(dist < 20) { playSound('hit'); bullets.splice(i, 1); if(myRole === 'p1' && b.owner === 'p1') { target.hp -= parseInt(gameConfig.dmg); update(ref(db, `arena/${currentRoomId}/p2/hp`), target.hp); } else if (myRole === 'p2' && b.owner === 'p2') { target.hp -= parseInt(gameConfig.dmg); update(ref(db, `arena/${currentRoomId}/p1/hp`), target.hp); } continue; } if(b.x < 0 || b.x > WIDTH) { bullets.splice(i, 1); continue; } let hitObs = false; obstacles.forEach(o => { if(b.x > o.x && b.x < o.x + o.w && b.y > o.y && b.y < o.y + o.h) hitObs=true; }); if(hitObs) bullets.splice(i, 1); }
        }
        
        function drawArenaGame() { 
            ctx.clearRect(0,0, WIDTH, HEIGHT); 
            ctx.fillStyle = "#5d4037"; obstacles.forEach(o => { ctx.fillRect(o.x, o.y, o.w, o.h); ctx.strokeStyle="#3e2723"; ctx.lineWidth=2; ctx.strokeRect(o.x,o.y,o.w,o.h); }); 
            ctx.fillStyle = "#ffff00"; bullets.forEach(b => { ctx.beginPath(); ctx.arc(b.x, b.y, 4, 0, Math.PI*2); ctx.fill(); }); 
            powerups.forEach(p => { ctx.fillStyle = p.type === 1 ? '#0f0' : '#ff0'; ctx.fillRect(p.x-10, p.y-10, 20, 20); ctx.strokeStyle='white'; ctx.strokeRect(p.x-10, p.y-10, 20, 20); ctx.fillStyle='black'; ctx.font='10px Arial'; ctx.fillText(p.type===1?"HP":"SP", p.x-7, p.y+4); });
            drawSoldier(p1); drawSoldier(p2); 
        }
        function drawSoldier(p) { ctx.save(); ctx.translate(p.x, p.y); ctx.fillStyle = p.color; ctx.beginPath(); ctx.arc(0, 0, 15, 0, Math.PI*2); ctx.fill(); ctx.strokeStyle = "white"; ctx.lineWidth = 2; ctx.stroke(); const img = avatarImgs[parseInt(p.avatar)||0]; if(img && img.complete) { ctx.beginPath(); ctx.arc(0,0,15,0,Math.PI*2); ctx.clip(); ctx.drawImage(img, -15,-15,30,30); } ctx.restore(); }
        
        function syncNetwork() { 
            if(myRole === 'spectator') return;
            const now = Date.now(); if(now - lastNetUpdate > 50) { const myObj = myRole === 'p1' ? p1 : p2; update(ref(db, `arena/${currentRoomId}/${myRole}`), { x: Math.round(myObj.x), y: Math.round(myObj.y) }); lastNetUpdate = now; } 
        }
        function endGame() { clearInterval(gameInterval); let msg = ""; if(p1.hp <= 0 && p2.hp <= 0) msg = "ØªØ¹Ø§Ø¯Ù„!"; else if(p1.hp <= 0) msg = "P2 ÙØ§Ø²!"; else msg = "P1 ÙØ§Ø²!"; playSound('win'); showToast(msg, "info"); exitGame(); addXP(100); }
        window.exitGame = () => { clearInterval(gameInterval); document.getElementById('game-canvas-modal').style.display = 'none'; if(myRole === 'p1' && currentRoomId) remove(ref(db, 'arena/' + currentRoomId)); currentRoomId = null; };
        
        function initJoystick() {
            const base = document.getElementById('joystick-base');
            const knob = document.getElementById('joystick-knob');
            base.addEventListener('touchstart', (e) => { e.preventDefault(); joystick.active = true; handleJoystickMove(e, base, knob); });
            base.addEventListener('touchmove', (e) => { e.preventDefault(); if(joystick.active) handleJoystickMove(e, base, knob); });
            base.addEventListener('touchend', (e) => { e.preventDefault(); joystick.active = false; joystick.dx = 0; joystick.dy = 0; knob.style.transform = `translate(0px, 0px)`; });
        }
        function handleJoystickMove(e, base, knob) {
            const touch = e.touches[0]; const rect = base.getBoundingClientRect(); const centerX = rect.left + rect.width / 2; const centerY = rect.top + rect.height / 2;
            let dx = touch.clientX - centerX; let dy = touch.clientY - centerY;
            const dist = Math.sqrt(dx*dx + dy*dy); const maxDist = rect.width / 2;
            if(dist > maxDist) { dx = (dx/dist)*maxDist; dy = (dy/dist)*maxDist; }
            knob.style.transform = `translate(${dx}px, ${dy}px)`; joystick.dx = dx / maxDist; joystick.dy = dy / maxDist;
        }

        /* =======================================================
           ADMIN SYSTEM ULTIMATE
           ======================================================= */
        let ctrlTargetID = null;
        let adminChatTargetID = null;

        window.toggleGhostMode = () => { isGhostMode = document.getElementById('chk-ghost-mode').checked; localStorage.setItem('adm_ghost', isGhostMode); showToast(isGhostMode ? "ğŸ‘» ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø´Ø¨Ø­" : "ğŸ‘» ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø´Ø¨Ø­", "info"); }
        if(isGhostMode) document.getElementById('chk-ghost-mode').checked = true;

        window.verifyAdmin = () => { 
            if(document.getElementById('adm-pass-input').value === 'yoyo020118') { 
                closeAll(); 
                document.getElementById('admin-main-panel').style.display = 'flex'; 
                isAdminLoggedIn = true; 
                showToast("Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ Ø£ÙŠÙ‡Ø§ Ø§Ù„Ø£Ø¯Ù…Ù†!", "success");
                initAdminSystem(); 
            } else {
                showToast("Ø±Ù…Ø² Ø®Ø§Ø·Ø¦!", "error"); 
            }
        }
        window.switchAdmTab = (tab) => { document.querySelectorAll('.adm-section').forEach(s => s.classList.remove('active')); document.querySelectorAll('.adm-nav-btn').forEach(b => b.classList.remove('active')); document.getElementById('adm-tab-'+tab).classList.add('active'); event.target.classList.add('active'); }

        function initAdminSystem() {
            get(ref(db, 'siteConfig')).then(snap => {
                const config = snap.val() || {};
                if(config.title) document.getElementById('set-site-title').value = config.title;
                if(config.welcomeMsg) document.getElementById('set-welcome-msg').value = config.welcomeMsg;
                if(config.themeColor) document.getElementById('set-theme-color').value = config.themeColor;
                if(config.dailyBonus) document.getElementById('set-daily-bonus').value = config.dailyBonus;
                if(config.breakingNews) document.getElementById('set-breaking-news').value = config.breakingNews;
                if(config.maintenance) document.getElementById('set-maintenance').checked = true;
                if(config.game) { document.getElementById('gm-speed').value=config.game.speed; document.getElementById('gm-dmg').value=config.game.dmg; document.getElementById('gm-hp').value=config.game.hp; }
                if(config.shop) { document.getElementById('shp-gold').value=config.shop.gold; document.getElementById('shp-red').value=config.shop.red; document.getElementById('shp-blue').value=config.shop.blue; document.getElementById('shp-vip').value=config.shop.vip; }
            });

            onValue(ref(db, 'onlineUsers'), (snap) => {
                const listContainer = document.getElementById('admin-online-list');
                const onlineData = snap.val() || {};
                document.getElementById('adm-online-count').innerText = Object.keys(onlineData).length;
                listContainer.innerHTML = '';
                Object.keys(onlineData).forEach(uid => {
                    get(ref(db, 'users/'+uid)).then(uSnap => {
                        const u = uSnap.val() || {name: 'Unknown', coins: 0};
                        const row = document.createElement('div'); 
                        row.className = 'online-user-row';
                        row.innerHTML = `<div style="flex:1;"><div style="font-weight:bold; color:white;">${u.name} <span class="online-status"></span></div><div style="font-size:10px; color:#777;">${uid}</div></div><div style="display:flex; align-items:center; gap:10px;"><span style="color:gold;">ğŸ’° ${u.coins}</span><button class="btn-ctrl-user" onclick="openCtrlBrowser('${uid}', '${u.name}', ${u.coins})">âš™ï¸ ØªØ­ÙƒÙ…</button></div>`;
                        listContainer.appendChild(row);
                    });
                });
            });

            onValue(query(ref(db, 'globalChat'), limitToLast(20)), (snap) => {
                const div = document.getElementById('chat-monitor-area'); div.innerHTML='';
                snap.forEach(c => {
                    const m = c.val();
                    const d = document.createElement('div'); d.className='monitor-msg-row';
                    d.innerHTML = `<div style="flex:1; color:white; font-size:12px;"><b>${m.name}:</b> ${m.text}</div><div class="monitor-actions"><button class="btn-del-msg" onclick="deleteGlobalMsg('${c.key}')">âŒ Ø­Ø°Ù</button><button class="btn-ban-user" onclick="openCtrlBrowser('${m.senderID}', '${m.name}', 0)">ğŸš« ØªØ­ÙƒÙ…</button></div>`;
                    div.appendChild(d);
                });
            });

            onValue(query(ref(db, 'logs/transactions'), limitToLast(20)), (snap) => {
                const tbody = document.getElementById('logs-table-body'); tbody.innerHTML='';
                snap.forEach(c => { const l = c.val(); const tr = document.createElement('tr'); tr.innerHTML = `<td>${l.from}</td><td>${l.to}</td><td>${l.amount}</td><td>${new Date(l.time).toLocaleTimeString()}</td>`; tbody.appendChild(tr); });
            });

            onValue(query(ref(db, 'logs/adminActions'), limitToLast(20)), (snap) => {
                const ul = document.getElementById('admin-actions-log'); ul.innerHTML='';
                snap.forEach(c => { const l = c.val(); const li = document.createElement('li'); li.innerText = `${l.action} - ${new Date(l.time).toLocaleTimeString()}`; ul.appendChild(li); });
            });

            onValue(ref(db, 'promoCodes'), snap => {
                const div = document.getElementById('codes-list'); div.innerHTML='';
                if(snap.val()) Object.keys(snap.val()).forEach(key => {
                    const val = snap.val()[key];
                    const d = document.createElement('div'); d.style.padding='5px'; d.style.borderBottom='1px solid #333';
                    d.innerHTML = `<span>${key} (${val.value})</span> <button onclick="deleteCode('${key}')" style="background:red;font-size:10px;padding:2px;">X</button>`;
                    div.appendChild(d);
                });
            });
            loadSupportListAndNotifications();
        }

        function logAdminAction(action) { push(ref(db, 'logs/adminActions'), { action: action, time: Date.now() }); }

        window.saveSiteConfig = () => {
            const updates = {
                title: document.getElementById('set-site-title').value,
                welcomeMsg: document.getElementById('set-welcome-msg').value,
                themeColor: document.getElementById('set-theme-color').value,
                dailyBonus: document.getElementById('set-daily-bonus').value,
                breakingNews: document.getElementById('set-breaking-news').value,
                maintenance: document.getElementById('set-maintenance').checked
            };
            update(ref(db, 'siteConfig'), updates).then(() => { logAdminAction('Updated Site Config'); showToast("Saved!", "success"); });
        }

        window.saveGameConfig = () => { update(ref(db, 'siteConfig/game'), { speed: document.getElementById('gm-speed').value, dmg: document.getElementById('gm-dmg').value, hp: document.getElementById('gm-hp').value }).then(() => showToast("Game Updated!", "success")); }
        window.saveShopConfig = () => { update(ref(db, 'siteConfig/shop'), { gold: document.getElementById('shp-gold').value, red: document.getElementById('shp-red').value, blue: document.getElementById('shp-blue').value, vip: document.getElementById('shp-vip').value }).then(() => showToast("Shop Updated!", "success")); }
        window.createPromoCode = () => { const code = document.getElementById('new-code-name').value.trim(); const val = document.getElementById('new-code-val').value; if(code && val) set(ref(db, 'promoCodes/'+code), { value: parseInt(val) }); }
        window.deleteCode = (c) => remove(ref(db, 'promoCodes/'+c));

        window.openCtrlBrowser = (uid, name, coins) => { 
            get(ref(db, 'users/'+uid+'/coins')).then(s => {
                const currentCoins = s.val() || 0;
                ctrlTargetID = uid; 
                document.getElementById('ctrl-target-name').innerText = name; 
                document.getElementById('ctrl-target-id').innerText = uid; 
                document.getElementById('ctrl-target-coins').innerText = currentCoins; 
                document.getElementById('user-control-browser').style.display = 'flex'; 
            });
        }
        window.closeCtrlBrowser = () => { document.getElementById('user-control-browser').style.display = 'none'; ctrlTargetID = null; }
        
        window.modifyTargetCoins = (multiplier) => { 
            if(!ctrlTargetID) return; const amtStr = document.getElementById('ctrl-amount-input').value; if(!amtStr) return showToast("Ø£Ø¯Ø®Ù„ Ø§Ù„ÙƒÙ…ÙŠØ©", "error"); 
            const amount = parseInt(amtStr) * multiplier; 
            get(ref(db, 'users/'+ctrlTargetID+'/coins')).then(s => { 
                const current = s.val() || 0; const newBal = current + amount; 
                update(ref(db, 'users/'+ctrlTargetID), { coins: newBal, alert: amount > 0 ? `ğŸ Ø£Ø¯Ù…Ù†: ØªÙ… Ù…Ù†Ø­Ùƒ ${amount} Ø¬ÙˆÙ‡Ø±Ø©` : `âš ï¸ Ø£Ø¯Ù…Ù†: ØªÙ… Ø®ØµÙ… ${Math.abs(amount)} Ø¬ÙˆÙ‡Ø±Ø©` }); 
                document.getElementById('ctrl-target-coins').innerText = newBal; 
                logAdminAction(`Modified coins for ${ctrlTargetID} by ${amount}`);
                showToast("ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„!", "success"); 
            }); 
        }
        
        window.banTargetUser = () => { if(!ctrlTargetID) return; if(confirm("Ø­Ø¸Ø± Ø§Ù„Ù„Ø§Ø¹Ø¨ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) { update(ref(db, 'users/'+ctrlTargetID), { banned: true }); logAdminAction(`Banned ${ctrlTargetID}`); showToast("ØªÙ… Ø§Ù„Ø­Ø¸Ø±", "success"); } }
        window.freezeTargetUser = () => { if(!ctrlTargetID) return; if(confirm("ØªØ¬Ù…ÙŠØ¯ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù„Ø§Ø¹Ø¨ØŸ")) { update(ref(db, 'users/'+ctrlTargetID), { frozen: true, alert: "â„ï¸ ØªÙ… ØªØ¬Ù…ÙŠØ¯ Ø­Ø³Ø§Ø¨Ùƒ Ù…Ø¤Ù‚ØªØ§Ù‹" }); logAdminAction(`Froze ${ctrlTargetID}`); showToast("ØªÙ… Ø§Ù„ØªØ¬Ù…ÙŠØ¯", "success"); } }
        window.unbanTargetUser = () => { if(!ctrlTargetID) return; if(confirm("ÙÙƒ Ø§Ù„Ø¹Ù‚ÙˆØ¨Ø§ØªØŸ")) { update(ref(db, 'users/'+ctrlTargetID), { banned: false, frozen: false }); logAdminAction(`Unbanned/Unfroze ${ctrlTargetID}`); showToast("ØªÙ… ÙÙƒ Ø§Ù„Ø­Ø¸Ø±", "success"); } }
        window.muteTargetUser = () => { if(!ctrlTargetID) return; update(ref(db, 'users/'+ctrlTargetID), { mutedUntil: Date.now() + 3600000 }); showToast("ØªÙ… ÙƒØªÙ… Ø§Ù„Ù„Ø§Ø¹Ø¨ Ù„Ø³Ø§Ø¹Ø©", "info"); }
        window.unmuteTargetUser = () => { if(!ctrlTargetID) return; update(ref(db, 'users/'+ctrlTargetID), { mutedUntil: 0 }); showToast("ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ÙƒØªÙ…", "info"); }
        window.clearGlobalChat = () => { if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø§Ù„Ø´Ø§Øª Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŸ")) { remove(ref(db, 'globalChat')); logAdminAction('Cleared Chat'); } }
        window.deleteGlobalMsg = (key) => { if(confirm("Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙÙ‚Ø·ØŸ")) remove(ref(db, 'globalChat/'+key)); }
        window.lockGlobalChat = () => update(ref(db, 'siteConfig'), { chatLocked: true });
        window.unlockGlobalChat = () => update(ref(db, 'siteConfig'), { chatLocked: false });
        window.sendPopupAlert = () => { const msg = document.getElementById('popup-msg-input').value; if(msg) update(ref(db, 'siteConfig/popupAlert'), { msg: msg, time: Date.now() }); showToast("Sent!", "success"); }

        function loadSupportListAndNotifications() {
            onValue(ref(db, 'users'), s => {
                const div = document.getElementById('support-users-list'); div.innerHTML = '';
                let usersWithMessages = []; let globalUnread = 0;
                if(s.val()) {
                    Object.keys(s.val()).forEach(uid => { const u = s.val()[uid]; if(u.messages) { const msgs = Object.values(u.messages); const lastMsg = msgs[msgs.length-1]; usersWithMessages.push({ uid: uid, name: u.name, lastTime: lastMsg.timestamp, lastSender: lastMsg.sender }); } });
                    usersWithMessages.sort((a,b) => b.lastTime - a.lastTime);
                    usersWithMessages.forEach(user => {
                        const btn = document.createElement('div'); btn.className = 'chat-list-item';
                        if(user.uid === adminChatTargetID) btn.classList.add('active');
                        btn.onclick = () => { adminChatTargetID = user.uid; loadAdminChat(user.uid, user.name); };
                        let unreadBadge = ''; if(user.lastSender === 'user') { unreadBadge = `<div class="unread-badge" style="display:block"></div>`; globalUnread++; playSound('notif'); }
                        btn.innerHTML = `${unreadBadge}<strong>${user.name}</strong><br><small style="color:#777">${new Date(user.lastTime).toLocaleTimeString()}</small>`; div.appendChild(btn);
                    });
                }
                const gBadge = document.getElementById('global-support-badge'); if(globalUnread > 0) { gBadge.style.display = 'block'; gBadge.innerText = globalUnread; } else gBadge.style.display = 'none';
            });
        }
        function loadAdminChat(uid, name) { if(adminChatTargetID) off(ref(db, 'users/'+adminChatTargetID+'/messages')); adminChatTargetID = uid; document.getElementById('adm-chat-header').innerText = "Ù…Ø¹: " + name; const chatBox = document.getElementById('adm-chat-box'); chatBox.innerHTML = 'loading...'; onValue(ref(db, 'users/'+uid+'/messages'), snap => { renderChat(chatBox, snap.val()); }); }
        window.sendAdminReply = () => { const txt = document.getElementById('adm-chat-reply').value; if(!txt || !adminChatTargetID) return; push(ref(db, 'users/'+adminChatTargetID+'/messages'), { sender: 'admin', text: txt, timestamp: Date.now() }); document.getElementById('adm-chat-reply').value = ''; }
        function renderChat(el, msgs) { el.innerHTML = ''; if(!msgs) return; Object.values(msgs).forEach(m => { const d = document.createElement('div'); let cl = (m.sender==='user') ? 'msg-user' : 'msg-admin'; d.className = `msg-bubble ${cl}`; d.innerHTML = `${m.text}`; el.appendChild(d); }); el.scrollTop = el.scrollHeight; }

        window.openSupport = () => { document.getElementById('user-chat-modal').style.display='flex'; document.getElementById('support-dot').style.display='none'; }
        window.openSettings = () => { 
            document.getElementById('settings-modal').style.display='flex'; 
            document.getElementById('input-name').value = myData.name; 
            document.getElementById('input-bio').value = myData.bio || "";
        }
        window.saveName = () => { 
            const newName = document.getElementById('input-name').value;
            const newBio = document.getElementById('input-bio').value;
            if(newName){ 
                myData.name = newName; 
                myData.bio = newBio || "";
                saveToServer(); 
                showToast("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ", "success"); 
                closeAll();
            } 
        }
        window.watchAd = (s,r) => { document.getElementById('ad-timer').style.display='block'; setTimeout(()=>{document.getElementById('ad-timer').style.display='none';myData.coins+=r;saveToServer();showToast("+"+r, "success")},s*100); }
        window.buyAcc = () => { if(myData.coins>=shopPrices.vip){myData.coins-=shopPrices.vip;myData.bought=true;saveToServer();}else showToast("ØªØ­ØªØ§Ø¬ "+shopPrices.vip, "error"); }
        window.toggleSidebar = () => document.getElementById('sidebar').classList.toggle('active');
        window.nav = (p) => { document.querySelectorAll('.page').forEach(x=>x.classList.remove('active')); document.getElementById(p).classList.add('active'); document.getElementById('sidebar').classList.remove('active'); if(p==='leaderboard') loadLeaderboard(); }
        window.closeAll = () => document.querySelectorAll('.modal').forEach(x=>x.style.display='none');
    </script>
</body>
</html>
